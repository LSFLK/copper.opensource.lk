



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Copper email solution documentation">
      
      
        <link rel="canonical" href="https://copper.opensource.lk/Backups/">
      
      
        <meta name="author" content="Lanka Software Foundation">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>Backup & Restoration - Copper mail</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ffa000">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="amber" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#backups-and-restoration" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://copper.opensource.lk" title="Copper mail" class="md-header-nav__button md-logo">
          
            <img src="../images/copper_logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Copper mail
            </span>
            <span class="md-header-nav__topic">
              Backup & Restoration
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://copper.opensource.lk" title="Copper mail" class="md-nav__button md-logo">
      
        <img src="../images/copper_logo.svg" width="48" height="48">
      
    </a>
    Copper mail
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../userfeature/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Structure/" title="Technical Documentation" class="md-nav__link">
      Technical Documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Installation/" title="Installation version 6" class="md-nav__link">
      Installation version 6
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Installation-7/" title="Installation version 7" class="md-nav__link">
      Installation version 7
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Configuration/" title="Initial Configuration" class="md-nav__link">
      Initial Configuration
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Backup & Restoration
      </label>
    
    <a href="./" title="Backup & Restoration" class="md-nav__link md-nav__link--active">
      Backup & Restoration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hostpath" title="hostPath" class="md-nav__link">
    hostPath
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-host-path-configuration" title="Sample host path configuration." class="md-nav__link">
    Sample host path configuration.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volume-configuration" title="Volume configuration." class="md-nav__link">
    Volume configuration.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-files-in-your-local-directory-with-rsync" title="Backup Files in your local directory With Rsync" class="md-nav__link">
    Backup Files in your local directory With Rsync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#now-time-to-automate-the-backup" title="Now time to automate the backup" class="md-nav__link">
    Now time to automate the backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volume-configuration-in-gke" title="Volume configuration in GKE" class="md-nav__link">
    Volume configuration in GKE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gcepersistentdisk" title="gcePersistentDisk" class="md-nav__link">
    gcePersistentDisk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../troubleshoot/" title="Troubleshoot" class="md-nav__link">
      Troubleshoot
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Hub/" title="Central Supervision" class="md-nav__link">
      Central Supervision
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../HubInstallation/" title="Copper Hub Installation" class="md-nav__link">
      Copper Hub Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Hubfeatures/" title="Copper Hub Features" class="md-nav__link">
      Copper Hub Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../issues/" title="Email security" class="md-nav__link">
      Email security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../future/" title="Next Features" class="md-nav__link">
      Next Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../lsf/" title="LSF" class="md-nav__link">
      LSF
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../F&Q/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contactus/" title="Contact us" class="md-nav__link">
      Contact us
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hostpath" title="hostPath" class="md-nav__link">
    hostPath
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-host-path-configuration" title="Sample host path configuration." class="md-nav__link">
    Sample host path configuration.
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volume-configuration" title="Volume configuration." class="md-nav__link">
    Volume configuration.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-files-in-your-local-directory-with-rsync" title="Backup Files in your local directory With Rsync" class="md-nav__link">
    Backup Files in your local directory With Rsync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#now-time-to-automate-the-backup" title="Now time to automate the backup" class="md-nav__link">
    Now time to automate the backup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volume-configuration-in-gke" title="Volume configuration in GKE" class="md-nav__link">
    Volume configuration in GKE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gcepersistentdisk" title="gcePersistentDisk" class="md-nav__link">
    gcePersistentDisk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LSFLK/Copper/edit/master/docs/Backups.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="backups-and-restoration">Backups and Restoration<a class="headerlink" href="#backups-and-restoration" title="Permanent link">&para;</a></h1>
<p align="justify">
Backups and restoration is requied to ensure bussiness continuty in any corporate environment. Copper Email solution is bit complex so it has varity of data sources to be backed up. 
Still this backup and restoration part is not completed, this is the initila plan and hope to complete backup with suitable backup management system with encription .

Even though backing up is automated there should be a possibility to manually run the backup process too. Further restoraion is also should be done using latest backups from a shell coammand.

</p>

<p>Copper system has 4 main data to make sure system is successfully backed up.</p>
<ol>
<li>secret.yaml </li>
<li>tls folder which has key files</li>
<li>data folder which has email maildir </li>
</ol>
<p>Pod(s) recovery when termination
What data should be backed up on below pods</p>
<ul>
<li>
<p>Email
    Mail directory is created inside the email pod and email container. So there should be a method to backup this directory for an immediate solution. This mail dir backup option is must.</p>
</li>
<li>
<p>LDAP
    Ldap directory can be exported as an “ldif” file or there is a directory to save ldap data. It is required to backup one of them. LDAP backup option can be done manually too due to use base is not regularly updating. But there must be a backup option.</p>
</li>
<li>
<p>Group-office
    This is a web application. The only way to make it redundant is taking a snapshot of the container. This is optional due to this can be reconfigure with little effort.</p>
</li>
<li>
<p>Mysql
    Mysql database is configured on persistent volumes. PV and PVC ramin until pods are deleted. But mysql database holds data of groupoffice. So if groupoffice pod is lost or terminated then database also has to rebuild.</p>
</li>
</ul>
<h2 id="hostpath">hostPath<a class="headerlink" href="#hostpath" title="Permanent link">&para;</a></h2>
<p align="justify">

<p>For bare metal implementations it is possible to use Hostpath.
A hostPathvolume mounts a file or directory from the host node’s file system into your Pod. This is not something that most Pods will need, but it offers a powerful escape hatch for some applications.
For example, some uses for a hostPathare:
running a Container that needs access to Docker internals; use a hostPathof /var/lib/docker
running cAdvisor in a Container; use a hostPathof /sys
allowing a Pod to specify whether a given hostPathshould exist prior to the Pod running, whether it should be created, and what it should exist as
In addition to the required path property, user can optionally specify a type for a hostPathvolume.</p>
<p>**** For copper solution we can use above solution according to whether it is bare metal implementation or GCE implementation.  So even though containers restarted there is no issue due to newly initiated containers will share same data. We had used hostpath solution in copper mail solution and temporarily removed due to users may find errors if they had not created the host path directory before the installation process.</p>
</p>

<h3 id="sample-host-path-configuration">Sample host path configuration.<a class="headerlink" href="#sample-host-path-configuration" title="Permanent link">&para;</a></h3>
<h4 id="volume-configuration">Volume configuration.<a class="headerlink" href="#volume-configuration" title="Permanent link">&para;</a></h4>
<p>Volume mount in container path</p>
<p><img alt="Volume Mounts" src="../images/backup/volumemount.png" /></p>
<p>This is a path in your localhost</p>
<p><img alt="Volumes" src="../images/backup/volume.png" /></p>
<p>Check local directory configured in your volumes.</p>
<p><img alt="Path" src="../images/backup/pwd.png" /></p>
<p>Check the Encripted mails inside mail directory.</p>
<p><img alt="Mail directory" src="../images/backup/maildir.png" /></p>
<p>Check the content of the mail whether it is encripted.</p>
<p><img alt="Encrypted mail" src="../images/backup/mail.png" /></p>
<p>So we can see that mail is encripted and it is possible to backup these mails somewhere else repository.</p>
<p>For this perpose we can use many kubernetes cloud storage solutions like. </p>
<div class="codehilite"><pre><span></span>awsElasticBlockStore
azureDisk
azureFile
cephfs
cinder
glusterfs
hostPath
iscsi
local
nfs
persistentVolumeClaim
projected
portworxVolume
quobyte
rbd
scaleIO
secret
storageos
</pre></div>


<p>One risk of keeping all your data on local machines is that in case of a natural disaster, fire or flood, your local system will be damaged and you will lose your data. It's recommended to keep another copy of your data on a machine located elsewhere.
Then we can sync mail directories using rsync command over network.</p>
<h4 id="backup-files-in-your-local-directory-with-rsync">Backup Files in your local directory With Rsync<a class="headerlink" href="#backup-files-in-your-local-directory-with-rsync" title="Permanent link">&para;</a></h4>
<p>This is where ssh protocol comes into play. I use the following syntax to sync a remote directory with a local directory:</p>
<div class="codehilite"><pre><span></span>rsync -avzP --delete -e ssh user@server_IP:source-directory /destination_directory_on_local_machine/
</pre></div>


<p>Example :</p>
<div class="codehilite"><pre><span></span>rsync -avzP --delete -e ssh 
 This e-mail address is being protected from spambots. You need JavaScript enabled to view it
 :/home/swapnil/backup/ /media/internal/local_backup/
</pre></div>


<p>To sync a local directory with a remote directory the syntax becomes:</p>
<div class="codehilite"><pre><span></span>rsync -avzP --delete -e ssh source_directory user@server_IP:path_destination_directory
</pre></div>


<p>Example :</p>
<div class="codehilite"><pre><span></span>rsync -avzP --delete -e ssh /home/swapnil/Downloads/ 
 user@server_IP:/home/swapnil/Downloads/
</pre></div>


<h3 id="now-time-to-automate-the-backup">Now time to automate the backup<a class="headerlink" href="#now-time-to-automate-the-backup" title="Permanent link">&para;</a></h3>
<p>Now run 'crontab -e' to create cron jobs. It will open an empty file where you can configure the command that you want to run at a desired time. (See image, above.)</p>
<p>The format of crontab is simple; it has five fields followed by the command:</p>
<div class="codehilite"><pre><span></span>m h dm m dw command
</pre></div>


<p>Here m stands for minutes (0-59); h for hour (0-23); dm for day of the month (1-31); m for month (1-12); and dw for day of the week (0-6 where 0 is Sunday). The format is numerical and you have to use ‘*’ to commend the fields that you don’t want to use.</p>
<p>I run the command every day at 11.30 so the format will be</p>
<div class="codehilite"><pre><span></span>30 23 * * * rsync -av --delete /media/hdd1/data-1/ /media/hdd2/data-2/
</pre></div>


<h2 id="volume-configuration-in-gke">Volume configuration in GKE<a class="headerlink" href="#volume-configuration-in-gke" title="Permanent link">&para;</a></h2>
<h3 id="gcepersistentdisk">gcePersistentDisk<a class="headerlink" href="#gcepersistentdisk" title="Permanent link">&para;</a></h3>
<p align="justify">

<p>A gcePersistentDiskvolume mounts a Google Compute Engine (GCE) Persistent Disk into your Pod. Unlike emptyDir, which is erased when a Pod is removed, the contents of a PD are preserved and the volume is merely unmounted. This means that a PD can be pre-populated with data, and that data can be “handed off” between Pods.
Caution:You must create a PD using gcloudor the GCE API or UI before you can use it.
    So email server Mail Dir will work with this solution. But the limitation is this is a GCD solution. But same optional services to be implemented for other cloud operators.</p>
</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Configuration/" title="Initial Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Initial Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../troubleshoot/" title="Troubleshoot" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Troubleshoot
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 Lanka Software Foundation
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.267712eb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>